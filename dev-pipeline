pipeline {

    agent any
	
	 environment {
	    earGitUrl= "${APP_EAR_GIT_URL}"
		earGitBranch= "master"
   
        propGitUrl= "${APP_PROP_GIT_URL}"
		propGitBranch= "master"
		
		appPropName="${APP_PROP_NAME}"
		
		manifestName = "manifest_dev.json"
	}
	
    stages {
	
        stage('Build') {
            steps {
                echo 'Building..'
				
				bat('tibcli -h')
				
				echo "PATH=$PATH"
            }
        }
		
		stage('artifacts'){
		   steps {
		          bat('tibcli -h')
				  echo '**************** checkout ear ***************************'
				  bat('tibcli -h')
				  git url: earGitUrl, branch: earGitBranch, credentialsId: 'git'
				  bat('tibcli -h')
				  echo '**************** Ear successfully downloaded ****************'
				  echo '**************** checkout properties from git ****************'
				  git url: propGitUrl, branch: propGitBranch, credentialsId: 'git'
                  

				  withCredentials([[$class: 'UsernamePasswordMultiBinding', credentialsId: 'TIBCO_TCI_CREDENTIALS', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD']])
                        {
                            // echo "$USERNAME"
							
							 bat('tibcli.exe login -u "$USERNAME" -p "$PASSWORD"')
                        }
				}
		}
        stage('Test') {
            steps {
                echo 'Testing..'
				bat('tibcli -h')
            }
        }
        stage('Deploy') {
            steps {
                echo 'Deploying....'
            }
        }
    }
}